<mvc:View xmlns:core="sap.ui.core" xmlns:l="sap.ui.layout" xmlns:f="sap.ui.layout.form"
          xmlns:html="http://www.w3.org/1999/xhtml" xmlns:mvc="sap.ui.core.mvc" xmlns:t="sap.ui.table" xmlns="sap.m"
          controllerName="sapui5agendar.sco00monitorcliente_html.controller.Master"
          xmlns:u="sap.uxap"
          xmlns:custom="sapui5agendar.sco00monitorcliente_html.customelements"
          xmlns:mp="sapui5agendar.sco00monitorcliente_html.customelements.monthpicker">
    <Shell id="shell">
        <App id="app">
            <pages>
                <Page id="page" title="{i18n>title}" showHeader="false">
                    <subHeader>
                        <Toolbar id="filters">
                            <Label class="sapUiSmallMarginBegin" text="Cliente:"/>
                            <Input showValueHelp="true" valueHelpRequest="handleSelectCliente" value="{
                                path:'/filters/Cliente',
                                type : 'sap.ui.model.type.String',
                                constraints:{minLength:1}
                            }" valueLiveUpdate="true" submit="handleSearch" width="12rem" />

                            <Label class="sapUiSmallMarginBegin" text="Sociedad"/>
                            <Select items="{/Sociedades}" selectedKey="{
                                path:'/filters/i_Sociedad',
                                type : 'sap.ui.model.type.String',
                                constraints:{minLength:1}
                            }" width="12rem">
                                <core:Item key="{BUKRS}" text="{BUKRS} - {BUTXT}"/>
                            </Select>
                            <Label text="Período:"/>
                            <mp:MonthPicker value="{
                                path:'/filters/Desde',
                                type: 'sapui5agendar.sco00monitorcliente_html.customelements.ExtendedDate',
                                constraints:{required:'true'},
                                formatOptions: {source: {pattern: 'MM/yyyy'}, pattern: 'MM/yyyy'}
                            }" valueState="{/filters/Fechas_State}" valueStateText="{/filters/Fechas_State_Text}" width="7rem" submit="handleSearch" />
                            <Text textAlign="Center" text=" - "/>
                            <mp:MonthPicker value="{
                                path:'/filters/Hasta',
                                type: 'sapui5agendar.sco00monitorcliente_html.customelements.ExtendedDate',
                                constraints:{required:'true'},
                                formatOptions: {source: {pattern: 'MM/yyyy'}, pattern: 'MM/yyyy'}
                            }" valueState="{/filters/Fechas_State}" valueStateText="{/filters/Fechas_State_Text}" width="7rem" submit="handleSearch" />
                            <ToolbarSpacer/>
                            <Button icon="sap-icon://search" text="Buscar" press="handleSearch"/>

                        </Toolbar>

                    </subHeader>

                    <u:ObjectPageLayout id="ObjectPageLayout" visible="{/VisibleResultado}" subSectionLayout="TitleOnTop" useIconTabBar="true">


                        <u:headerTitle>

                            <u:ObjectPageHeader id="headerForTest" headerDesign="Light" objectTitle="{/DatosCliente/T_KNA1/NAME1} {/DatosCliente/T_KNA1/NAME2}" objectImageShape="Circle">
                            </u:ObjectPageHeader>

                        </u:headerTitle>

                        <u:headerContent>
                            <ObjectStatus title="Dirección" text="{/DatosCliente/T_KNA1/STRAS}"/>
                            <ObjectStatus title="Teléfonos" text="{/DatosCliente/T_KNA1/TELF1} {/DatosCliente/T_KNA1/TELF2} {/DatosCliente/TEL_MOVIL}"/>
                            <ObjectStatus title="Email" text="{/DatosCliente/EMAIL}"/>
                            <ObjectStatus title="Grupo" text="{/DatosCliente/T_KNA1/KONZS}" visible="{=${/DatosCliente/T_KNA1/KONZS} !== ''}"/>
                        </u:headerContent>

                        <u:sections>


                            <u:ObjectPageSection title="Control de Crédito">

                                <u:subSections>

                                    <u:ObjectPageSubSection title="Antecedentes Comerciales">
                                        <u:blocks>

                                            <l:Grid defaultSpan="XL6 L6 M8 S12">
                                                <Panel headerText="Volumen de Venta para la Sociedad">
                                                    <f:SimpleForm layout="ResponsiveGridLayout" labelSpanXL="3" labelSpanL="4" labelSpanM="4" labelSpanS="4" adjustLabelSpan="false" emptySpanXL="0" emptySpanL="0" emptySpanM="0" emptySpanS="0" width="100%">
                                                        <f:content >
                                                            <Label text="Periodo Análisis"/>
                                                            <Text class="dateRangeText" text="{/AntecedentesComerciales/E_PERIO_DESDE_TXT} - {/AntecedentesComerciales/E_PERIO_HASTA_TXT}"/>

                                                            <Label text="Sociedad"/>
                                                            <Text text="{/AntecedentesComerciales/E_SOCIEDAD_TXT}"/>

                                                            <Label text="Volumen Negocio Cliente"/>
                                                            <Text text="{
                                                            path:'/AntecedentesComerciales/E_VOLUMEN_SOC',
                                                            type:'sap.ui.model.type.Integer',
                                                            formatOptions:{
                                                                groupingEnabled:true
                                                            }
                                                        }"/>

                                                            <Label text="Holding"/>
                                                            <Text text="{
                                                            path:'/AntecedentesComerciales/E_VOLUMEN_HOL',
                                                            type:'sap.ui.model.type.Integer',
                                                            formatOptions:{
                                                                groupingEnabled:true
                                                            }
                                                        }"/>

                                                            <Label text="Volumen Grupo"/>
                                                            <Text text="{
                                                            path:'/AntecedentesComerciales/E_VOLUMEN_GRP',
                                                            type:'sap.ui.model.type.Integer',
                                                            formatOptions:{
                                                                groupingEnabled:true
                                                            }
                                                        }"/>
                                                        </f:content>
                                                    </f:SimpleForm>
                                                </Panel>

                                                <Panel headerText="Última Venta">
                                                    <f:SimpleForm layout="ResponsiveGridLayout" labelSpanXL="3" labelSpanL="4" labelSpanM="4" labelSpanS="4" adjustLabelSpan="false" emptySpanXL="0" emptySpanL="0" emptySpanM="0" emptySpanS="0" width="100%">
                                                        <f:content >
                                                            <Label text="Fecha Última Venta"/>
                                                            <Text text="{
                                                            path:'/AntecedentesComerciales/E_UVTA_FECHA',
                                                            type:'sap.ui.model.type.Date',
                                                            formatOptions:{source:{pattern:'yyyy-MM-dd'}, pattern:'dd/MM/yyyy'}
                                                        }"/>

                                                            <Label text="Vendedor"/>
                                                            <Text text="{/AntecedentesComerciales/E_UVTA_GRVEN_TXT}"/>

                                                            <Label text="Oficina de Ventas"/>
                                                            <Text text="{/AntecedentesComerciales/E_UVTA_OFVTA_TXT}"/>

                                                            <Label text="Valor Neto"/>
                                                            <Text text="{
                                                            path:'/AntecedentesComerciales/E_UVTA_NETWR',
                                                            type:'sap.ui.model.type.Integer',
                                                            formatOptions:{
                                                                groupingEnabled:true
                                                            }
                                                        }"/>

                                                            <Label text="Documento Comercial"/>
                                                            <Text text="{/AntecedentesComerciales/E_UVTA_VBELN}"/>
                                                        </f:content>
                                                    </f:SimpleForm>
                                                </Panel>

                                                <Panel headerText="Volumen de Venta por Unidad de Negocio">
                                                    <f:SimpleForm layout="ResponsiveGridLayout" labelSpanXL="3" labelSpanL="4" labelSpanM="4" labelSpanS="4" adjustLabelSpan="false" emptySpanXL="0" emptySpanL="0" emptySpanM="0" emptySpanS="0" width="100%">
                                                        <f:content >
                                                            <t:TreeTable rows="{path:'/AntecedentesComerciales/UnidadesNegocio', parameters: {arrayNames:['Unidades']}}" ariaLabelledBy="title" selectionMode="None">
                                                                <t:columns>
                                                                    <t:Column width="60%">
                                                                        <Label text="Unidad Negocio / Sector"/>
                                                                        <t:template>
                                                                            <Text text="{Descripcion}" wrapping="false"/>
                                                                        </t:template>
                                                                    </t:Column>
                                                                    <t:Column width="40%">
                                                                        <Label text="Volumen Ventas ($)"/>
                                                                        <t:template>
                                                                            <Text text="{
                                                                            path:'Volumen',
                                                                            type:'sap.ui.model.type.Integer',
                                                                            formatOptions:{
                                                                                groupingEnabled:true
                                                                            }
                                                                        }"/>
                                                                        </t:template>
                                                                    </t:Column>
                                                                </t:columns>
                                                            </t:TreeTable>
                                                        </f:content>
                                                    </f:SimpleForm>
                                                </Panel>
                                                <Panel headerText="Resúmen Documentos">
                                                    <f:SimpleForm layout="ResponsiveGridLayout" labelSpanXL="3" labelSpanL="4" labelSpanM="4" labelSpanS="4" adjustLabelSpan="false" emptySpanXL="0" emptySpanL="0" emptySpanM="0" emptySpanS="0" width="100%">
                                                        <f:content >
                                                            <Label text="Cantidad Cotizaciones"/>
                                                            <Link press="handleCotizacionesDetails" text="{/AntecedentesComerciales/E_CANT_COTI}" enabled="{=${/AntecedentesComerciales/E_CANT_COTI} > 0}"/>
                                                            <Label text="Cantidad Facturas"/>
                                                            <Link press="handleFacturasDetails" text="{/AntecedentesComerciales/E_CANT_FACT}" enabled="{=${/AntecedentesComerciales/E_CANT_FACT} > 0}"/>
                                                            <Label text="Cantidad Ot Procesadas"/>
                                                            <Link press="handleOrdenesDetails" text="{/AntecedentesComerciales/E_CANT_OTEP}" enabled="{=${/AntecedentesComerciales/E_CANT_OTEP} > 0}"/>
                                                            <Label text="Cantidad Leasing"/>
                                                            <Link press="handleLeasingDetails" text="{/AntecedentesComerciales/E_CANT_LEASING}" enabled="{=${/AntecedentesComerciales/E_CANT_LEASING} > 0}"/>
                                                        </f:content>
                                                    </f:SimpleForm>
                                                </Panel>
                                            </l:Grid>

                                        </u:blocks>


                                    </u:ObjectPageSubSection>

                                </u:subSections>

                            </u:ObjectPageSection>

                            <u:ObjectPageSection title="Antecedentes Financieros">
                                <u:subSections>
                                    <u:ObjectPageSubSection title=" ">
                                        <IconTabBar id="idIconTabBar" select="handleIconTabBarSelect">
                                            <items>
                                                <IconTabFilter text="Control de Crédito">
                                                    <f:SimpleForm layout="ResponsiveGridLayout" labelSpanXL="3" labelSpanL="4" labelSpanM="4" labelSpanS="4" adjustLabelSpan="false" emptySpanXL="0" emptySpanL="0" emptySpanM="0" emptySpanS="0" width="50%" editable="true">
                                                        <f:content>
                                                            <Label text="Area Control Credito"/>
                                                            <Select items="{/AreasControlCredito}" selectedKey="{/i_AreaControlCredito}" change="handleAreaCCChange">
                                                                <core:Item key="{KKBER}" text="{KKBTX}"/>
                                                            </Select>
                                                        </f:content>
                                                    </f:SimpleForm>
                                                    <l:Grid defaultSpan="XL12 L12 M8 S12">
                                                        <l:VerticalLayout width="100%">
                                                            <Panel headerText="Límite de Crédito">
                                                                <l:Grid defaultSpan="XL6 L6 M6 S12">
                                                                    <f:SimpleForm layout="ResponsiveGridLayout" labelSpanXL="3" labelSpanL="4" labelSpanM="4" labelSpanS="4" adjustLabelSpan="false" emptySpanXL="0" emptySpanL="0" emptySpanM="0" emptySpanS="0">
                                                                        <f:content >
                                                                            <Label text="Límite de Crédito"/>
                                                                            <Text text="{path:'/AntecedentesFinancieros/ControlCreditos/E_CREDITLIMIT',formatter: '.multiplicarMontoFormatter'}"/>
                                                                            <Label text="Cuenta Crédito"/>
                                                                            <Text text="{/AntecedentesFinancieros/ControlCreditos/E_KNKLI}"/>
                                                                            <Label text="Grado de agot. (%)"/>
                                                                            <Text text="{/AntecedentesFinancieros/ControlCreditos/E_PERCENTAGE}"/>
                                                                        </f:content>
                                                                    </f:SimpleForm>
                                                                    <f:SimpleForm layout="ResponsiveGridLayout" labelSpanXL="3" labelSpanL="4" labelSpanM="4" labelSpanS="4" adjustLabelSpan="false" emptySpanXL="0" emptySpanL="0" emptySpanM="0" emptySpanS="0">
                                                                        <f:content >
                                                                            <Label text="Créditos"/>
                                                                            <Text text="{path:'/AntecedentesFinancieros/ControlCreditos/E_OPEN_ITEMS',formatter: '.multiplicarMontoFormatter'}"/>
                                                                            <Label text="Compromet. Esp."/>
                                                                            <Text text="{path:'/AntecedentesFinancieros/ControlCreditos/E_OPEN_SPECIALS',formatter: '.multiplicarMontoFormatter'}"/>
                                                                            <Label text="Val. Comercial"/>
                                                                            <Text text="{path:'/AntecedentesFinancieros/ControlCreditos/E_VAL_COMERCIAL',formatter: '.multiplicarMontoFormatter'}"/>
                                                                            <Label text="Comprom. Total"/>
                                                                            <Text text="{path:'/AntecedentesFinancieros/ControlCreditos/E_SUM_OPENS',formatter: '.multiplicarMontoFormatter'}"/>
                                                                        </f:content>
                                                                    </f:SimpleForm>
                                                                </l:Grid>
                                                            </Panel>
                                                            <Panel headerText="Datos Internos">
                                                                <l:Grid defaultSpan="XL6 L6 M6 S12">
                                                                    <f:SimpleForm layout="ResponsiveGridLayout" labelSpanXL="3" labelSpanL="4" labelSpanM="4" labelSpanS="4" adjustLabelSpan="false" emptySpanXL="0" emptySpanL="0" emptySpanM="0" emptySpanS="0">
                                                                        <f:content >
                                                                            <Label text="Grupo Crédito Cliente"/>
                                                                            <Link text="{/AntecedentesFinancieros/ControlCreditos/E_KNKK/CTLPC}" press="handleCreditoClienteDetail"/>
                                                                            <Label text="Equipo Responsable"/>
                                                                            <Link text="{/AntecedentesFinancieros/ControlCreditos/E_KNKK/SBGRP}" press="handleEquipoResponsableDetail"/>
                                                                            <Label text="Grupo Clientes"/>
                                                                            <Text text="{/AntecedentesFinancieros/ControlCreditos/E_KNKK/KDGRP}"/>
                                                                        </f:content>
                                                                    </f:SimpleForm>
                                                                    <f:SimpleForm layout="ResponsiveGridLayout" labelSpanXL="3" labelSpanL="4" labelSpanM="4" labelSpanS="4" adjustLabelSpan="false" emptySpanXL="0" emptySpanL="0" emptySpanM="0" emptySpanS="0" editable="true">
                                                                        <f:content >
                                                                            <Label text="Bloqueado"/>
                                                                            <CheckBox editable="false" selected="{=${/AntecedentesFinancieros/ControlCreditos/E_KNKK/CRBLB}==='X'}"/>
                                                                        </f:content>
                                                                    </f:SimpleForm>
                                                                </l:Grid>
                                                            </Panel>
                                                            <Panel headerText="Datos Externos">
                                                                <l:Grid defaultSpan="XL6 L6 M6 S12">
                                                                    <f:SimpleForm layout="ResponsiveGridLayout" labelSpanXL="3" labelSpanL="4" labelSpanM="4" labelSpanS="4" adjustLabelSpan="false" emptySpanXL="0" emptySpanL="0" emptySpanM="0" emptySpanS="0">
                                                                        <f:content >
                                                                            <Label text="Calificación Crediticia"/>
                                                                            <Text text="{/AntecedentesFinancieros/ControlCreditos/E_KNKK/DBRTG}"/>
                                                                        </f:content>
                                                                    </f:SimpleForm>
                                                                </l:Grid>
                                                            </Panel>
                                                            <Panel headerText="Vias y Cond. Pago">
                                                                <l:Grid defaultSpan="XL6 L6 M6 S12">
                                                                    <f:SimpleForm layout="ResponsiveGridLayout" labelSpanXL="3" labelSpanL="4" labelSpanM="4" labelSpanS="4" adjustLabelSpan="false" emptySpanXL="0" emptySpanL="0" emptySpanM="0" emptySpanS="0">
                                                                        <f:content >
                                                                            <Label text="Vías Pago"/>
                                                                            <Text text="{/AntecedentesFinancieros/ControlCreditos/E_VIAS_PAGO}"/>
                                                                            <core:Icon src="sap-icon://message-information" width="3rem" tooltip="{/AntecedentesFinancieros/Descripciones/ViasPagoTooltip}"/>
                                                                        </f:content>
                                                                    </f:SimpleForm>
                                                                    <f:SimpleForm layout="ResponsiveGridLayout" labelSpanXL="3" labelSpanL="4" labelSpanM="4" labelSpanS="4" adjustLabelSpan="false" emptySpanXL="0" emptySpanL="0" emptySpanM="0" emptySpanS="0">
                                                                        <f:content >
                                                                            <Label text="Condición Pago"/>
                                                                            <Link text="{/AntecedentesFinancieros/ControlCreditos/E_COND_PAGO}" press="handleCondicionPagoDetail"/>
                                                                        </f:content>
                                                                    </f:SimpleForm>
                                                                </l:Grid>
                                                            </Panel>
                                                        </l:VerticalLayout>
                                                    </l:Grid>
                                                </IconTabFilter>
                                                <IconTabFilter text="Composición deuda">
                                                    <Panel headerText="Cuentas de Mayor Especiales">
                                                        <t:Table class="sapUiSmallMargin" selectionMode="None" visibleRowCount="5" rows="{/AntecedentesFinancieros/ComposicionDeuda}">
                                                            <t:columns>
                                                                <t:Column autoResizable="true">
                                                                    <Label text="Operación"/>
                                                                    <t:template>
                                                                        <Text text="{TEXT}" wrapping="false"/>
                                                                    </t:template>
                                                                </t:Column>
                                                                <t:Column autoResizable="true">
                                                                    <Label text="Saldo"/>
                                                                    <t:template>
                                                                        <Text text="{path:'BALANCE', formatter: '.multiplicarMontoFormatter'}"/>
                                                                    </t:template>
                                                                </t:Column>
                                                            </t:columns>
                                                            <t:footer>
                                                                <Toolbar>
                                                                    <ToolbarSpacer/>
                                                                    <Text text="TOTAL:"/>
                                                                    <Text text="{path:'/AntecedentesFinancieros/TotalDeuda', formatter: '.multiplicarMontoFormatter'}"/>
                                                                </Toolbar>
                                                            </t:footer>
                                                        </t:Table>
                                                    </Panel>
                                                </IconTabFilter>
                                                <IconTabFilter text="Estructura vencimientos">
                                                    <Panel headerText="Documentos Morosos" class="sapUiSmallMarginBottom">
                                                        <Table class="sapUiSmallMargin" headerText="Documentos Morosos" items="{/AntecedentesFinancieros/DocumentosMorosos}">
                                                            <headerToolbar>
                                                                <Toolbar>
                                                                    <Label text="Cuadro"/>
                                                                    <Select items="{/Vencimientos}" selectedKey="{/i_Vencimiento}" change="handleVencimientoChange">
                                                                        <core:Item key="{RASID}" text="{LTEXT}"/>
                                                                    </Select>
                                                                </Toolbar>
                                                            </headerToolbar>
                                                            <columns>
                                                                <Column mergeDuplicates="true">
                                                                    <header>
                                                                        <Label text="Sociedad"/>
                                                                    </header>
                                                                </Column>
                                                                <Column>
                                                                    <header>
                                                                        <Label text="Cuadro"/>
                                                                    </header>
                                                                </Column>
                                                                <Column>
                                                                    <header>
                                                                        <Label text="Vencidas"/>
                                                                    </header>
                                                                </Column>
                                                            </columns>
                                                            <ColumnListItem>
                                                                <Text text="{BUKRS}"/>
                                                                <Text text="{GRIDT}"/>
                                                                <Text text="{
                                                                path:'SFAET',
                                                                type:'sap.ui.model.type.Integer',
                                                                formatOptions:{
                                                                    groupingEnabled:true
                                                                }
                                                          }" wrapping="false"/>
                                                            </ColumnListItem>
                                                        </Table>
                                                    </Panel>
                                                    <l:Grid width="20rem" defaultSpan="XL6 L6 M6 S6">
                                                        <Label text="Vencidas: "/>
                                                        <Text text="{path:'/AntecedentesFinancieros/DocumentosMorosos',formatter: '.morososVencidasFormatter'}"/>
                                                    </l:Grid>
                                                    <l:Grid width="20rem" defaultSpan="XL6 L6 M6 S6">
                                                        <Label text="No vencidas: "/>
                                                        <Text text="{path:'/AntecedentesFinancieros/DocumentosMorosos',formatter: '.morososNoVencidasFormatter'}"/>
                                                    </l:Grid>
                                                    <l:Grid width="20rem" defaultSpan="XL6 L6 M6 S6">
                                                        <Label text="Total: "/>
                                                        <Text text="{path:'/AntecedentesFinancieros/DocumentosMorosos',formatter: '.morososTotalFormatter'}"/>
                                                    </l:Grid>
                                                </IconTabFilter>
                                            </items>
                                        </IconTabBar>
                                    </u:ObjectPageSubSection>
                                </u:subSections>
                            </u:ObjectPageSection>

                        </u:sections>


                    </u:ObjectPageLayout>

                    <footer>
                        <Toolbar>
                            <Button id="errorPopover" icon="sap-icon://message-popup" visible="{= ${message>/}.length > 0}" text="{= ${message>/}.length}" type="Emphasized" press="handleMessagePopoverPress"/>
                            <ToolbarSpacer/>
                        </Toolbar>
                    </footer>

                    <content>


                    </content>

                </Page>
            </pages>
        </App>
    </Shell>
</mvc:View>
