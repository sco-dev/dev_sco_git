<mvc:View xmlns:core="sap.ui.core"
    xmlns:l="sap.ui.layout"
    xmlns:f="sap.ui.layout.form"
    xmlns:html="http://www.w3.org/1999/xhtml"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:t="sap.ui.table"
    xmlns="sap.m" controllerName="sapui5agendar.sco00crearanticipo_html.controller.Master"
    xmlns:custom="sapui5agendar.sco00crearanticipo_html.customelements"
    xmlns:app="http://schemas.sap.com/sapui5/extension/sap.ui.core.CustomData/1">

    <Shell id="shell">
        <App id="app" class="sapUiSizeCompact">
            <pages>
                <Page showHeader="false" enableScrolling="true" class="sapUiContentPadding">
                    <content>
                        <Panel>
                            <f:SimpleForm width="100%" adjustLabelSpan="false" emptySpanXL="0" emptySpanL="0" emptySpanM="0" emptySpanS="0" layout="ResponsiveGridLayout" id="form" editable="true">
                                <f:content>
                                    <f:SimpleForm width="100%" adjustLabelSpan="false" editable="true" layout="ResponsiveGridLayout" emptySpanXL="0" emptySpanL="0" emptySpanM="0" emptySpanS="0" labelSpanXL="4" labelSpanL="4" labelSpanM="4" labelSpanS="4">
                                        <f:content>
                                            <Label text="Cliente (RUT)" required="true"/>
                                            <custom:ExtendedInput showValueHelp="true" valueHelpRequest="handleSelectCliente" value="{
                                            path:'/Cliente',
                                            type : 'sap.ui.model.type.String',
                                            constraints:{minLength:1}
                                        }" valueState="{/ClienteState}" valueStateText="{/ClienteStateText}" valueLiveUpdate="true">
                                            </custom:ExtendedInput>

                                            <Label text="Sociedad" required="true"/>
                                            <Select items="{/Sociedades}" selectedKey="{
                                                path:'/i_Sociedad',
                                                type : 'sap.ui.model.type.String',
                                                constraints:{minLength:1}
                                            }" change="handleSociedadChange">
                                                <core:Item key="{CODIGO}" text="{DESCRIPCION}"/>
                                            </Select>

                                            <Label text="Area Control Crédito" required="true"/>
                                            <Select items="{/Areas_Control_Credito}" selectedKey="{
                                                path:'/i_Area_Control_Credito',
                                                type : 'sap.ui.model.type.String',
                                                constraints:{minLength:1}
                                            }" change="handleAreaControlChange" forceSelection="false">
                                                <core:Item key="{KKBER}" text="{KKBER} - {KKBTX}"/>
                                            </Select>
                                        </f:content>
                                    </f:SimpleForm>
                                    <f:SimpleForm width="100%" adjustLabelSpan="false" editable="true" layout="ResponsiveGridLayout" emptySpanXL="0" emptySpanL="0" emptySpanM="0" emptySpanS="0" labelSpanXL="4" labelSpanL="4" labelSpanM="4" labelSpanS="4" visible="{/Visible_form}">
                                        <f:content>
                                            <Label text="Ciudad" required="true"/>
                                            <Select items="{/Ciudades}" selectedKey="{
                                                path:'/i_Ciudad',
                                                type : 'sap.ui.model.type.String',
                                                constraints:{minLength:1}
                                            }" change="handleCiudadChange" forceSelection="false">
                                                <core:Item key="{SETNAME}" text="{DESCRIPT}"/>
                                            </Select>

                                            <Label text="Sucursal" required="true"/>
                                            <Select items="{/Sucursales}" selectedKey="{
                                                path:'/i_Sucursal',
                                                type : 'sap.ui.model.type.String',
                                                constraints:{minLength:1}
                                            }" change="handleSucursalChange" forceSelection="false">
                                                <core:Item key="{SETNAME}" text="{DESCRIPT}"/>
                                            </Select>

                                            <Label text="Unidad de Negocio" required="true"/>
                                            <Select items="{/Unidades_Negocio}" selectedKey="{
                                                path:'/i_Unidad_Negocio',
                                                type : 'sap.ui.model.type.String',
                                                constraints:{minLength:1}
                                            }" change="handleUnidadNegocioChange" forceSelection="false">
                                                <core:Item key="{SETNAME}" text="{DESCRIPT}"/>
                                            </Select>

                                            <Label text="Centro de Beneficio" required="true"/>
                                            <Select items="{/Centros_Beneficio}" selectedKey="{
                                                path:'/i_Centro_Beneficio',
                                                type : 'sap.ui.model.type.String',
                                                constraints:{minLength:1}
                                            }" change="handleCentroBeneficioChange" forceSelection="false">
                                                <core:Item key="{SETNAME}" text="{DESCRIPT}"/>
                                            </Select>

                                            <Label text="Oficina de Venta" required="true"/>
                                            <Select items="{/Oficinas_Venta}" selectedKey="{
                                                path:'/i_Oficina_Venta',
                                                type : 'sap.ui.model.type.String',
                                                constraints:{minLength:1}
                                            }" change="handleOficinaVentaChange" forceSelection="false">
                                                <core:Item key="{OFICINA}" text="{OFICINA} - {DESCRIPCION}"/>
                                            </Select>

                                            <Label text="Grupo de Vendedor" required="true"/>
                                            <Select items="{/Grupos_Vendedor}" selectedKey="{
                                                path:'/i_Grupo_Vendedor',
                                                type : 'sap.ui.model.type.String',
                                                constraints:{minLength:1}
                                            }" change="handleGrupoVendedorChange" enabled="{/GrpVenta_enabled}" forceSelection="false">
                                                <core:Item key="{GRUPO}" text="{GRUPO} - {DESCRIPCION}"/>
                                            </Select>

                                        </f:content>
                                    </f:SimpleForm>
                                </f:content>
                            </f:SimpleForm>

                            <t:Table id="tableMedios" editable="true" class="sapUiSmallMargin" selectionMode="Single" selectionBehavior="Row" noData="No se han agregado condiciones" rows="{/Medios_Pago}" selectedIndex="{/i_Medio_Pago}" visibleRowCount="10" rowSelectionChange="handleRowSelect">
                                <t:toolbar>
                                    <Toolbar>
                                        <Label text="Vía de pago" />
                                        <Select items="{/Vias_Pago}" selectedKey="{/i_Via_Pago}" forceSelection="false">
                                            <core:Item key="{ZLSCH}" text="{ZLSCH} - {DESC_VIA_PAG}"/>
                                        </Select>

                                        <Button class="sapUiTinyMarginBegin" text="Agregar" icon="sap-icon://add-document" press="handleAddMedioPago"/>

                                        <ToolbarSeparator/>
                                        <Button class="sapUiTinyMarginBegin" text="Eliminar" icon="sap-icon://negative" press="handleRemoveMedioPago"/>
                                        <ToolbarSpacer/>
                                        <Button class="sapUiTinyMarginBegin" text="Actualizar" icon="sap-icon://refresh" press="handleRefreshMedioPago"/>
                                    </Toolbar>
                                </t:toolbar>
                                <t:columns>
                                    <t:Column autoResizable="true">
                                        <Label text="Vía Pago"/>
                                        <t:template>
                                            <Text text="{VIA_PAGO_DESCRIPTION}" wrapping="false"/>
                                        </t:template>
                                    </t:Column>

                                    <t:Column>
                                        <Label text="Concepto"/>
                                        <t:template>
                                            <Select items="{enums>/CHQ_CONCEPTOS}" selectedKey="{path:'WSTAT'}" visible="{CHQ_ENABLE}" forceSelection="false">
                                                <core:Item key="{enums>CODIGO}" text="{enums>CODIGO} - {enums>DESCRIPCION}"/>
                                            </Select>
                                        </t:template>
                                    </t:Column>

                                    <t:Column autoResizable="true">
                                        <Label text="Fecha"/>
                                        <t:template>
                                            <DatePicker value="{
                                                    path: 'FECHA',
                                                    type: 'sap.ui.model.type.Date',
                                                    formatOptions: {source: {pattern: 'yyyyMMdd'}, pattern: 'dd/MM/yyyy'}
                                                  }" valueFormat="yyyyMMdd"/>
                                        </t:template>
                                    </t:Column>
                                    <t:Column autoResizable="true">
                                        <Label text="Dias"/>
                                        <t:template>
                                            <Text text="{path: 'FECHA',formatter:'.formatDias'}" wrapping="false"/>
                                        </t:template>
                                    </t:Column>
                                    <t:Column autoResizable="true">
                                        <Label text="Moneda"/>
                                        <t:template>
                                            <Text text="{MONEDA}" wrapping="false"/>
                                        </t:template>
                                    </t:Column>
                                    <t:Column autoResizable="true">
                                        <Label text="Monto"/>
                                        <t:template>
                                            <Input value="{path:'MONTO', type : 'sap.ui.model.type.Float', formatOptions: {minIntegerDigits:1,maxFractionDigits: 2}}" submit="handleRefreshMedioPago" change="handleCalcularTotal"/>
                                        </t:template>
                                    </t:Column>
                                </t:columns>
                                <t:footer>
                                    <Toolbar>
                                        <ToolbarSpacer/>
                                        <Text text="Total:"/>
                                        <Text text="{path:'/TotalMonto', type : 'sap.ui.model.type.Integer', formatOptions: {groupingEnabled:true}}"/>
                                    </Toolbar>
                                </t:footer>
                            </t:Table>

                            <f:SimpleForm width="100%" adjustLabelSpan="false" emptySpanXL="0" emptySpanL="0" emptySpanM="0" emptySpanS="0" layout="ResponsiveGridLayout" id="subForm" editable="true">
                                <f:content>
                                    <f:SimpleForm width="100%" adjustLabelSpan="false" editable="true" layout="ResponsiveGridLayout" emptySpanXL="0" emptySpanL="0" emptySpanM="0" emptySpanS="0" labelSpanXL="2" labelSpanL="2" labelSpanM="2" labelSpanS="2">
                                        <f:content>


                                            <Label visible="{/Visible_rut}" text="Rut" required="true"/>
                                            <Input visible="{/Visible_rut}" value="{
                                                    path:'/Rut',
                                                    type : 'sapui5agendar.sco00crearanticipo_html.customelements.ExtendedString',
                                                    constraints:{ type: 'rut',minLength:1 }
                                                }" width="30rem" valueState="{/RutState}" valueStateText="{/RutStateText}" change="handleSubFormChange" app:identificador="rut"/>

                                            <Label visible="{/Visible_operacion}" text="Operación" required="true"/>
                                            <Input visible="{/Visible_operacion}" value="{
                                                path:'/Operacion',
                                                type : 'sap.ui.model.type.String',
                                                constraints:{minLength:1}
                                            }" width="30rem" change="handleSubFormChange" app:identificador="operacion"/>

                                            <Label visible="{/Visible_numeroOC}" text="OC" required="true"/>
                                            <Input visible="{/Visible_numeroOC}" value="{
                                                path:'/NumeroOC',
                                                type : 'sap.ui.model.type.String',
                                                constraints:{minLength:1}
                                            }" width="30rem" change="handleSubFormChange" app:identificador="numerooc"/>

                                            <Label visible="{/Visible_banco}" text="Banco" required="true" />
                                            <Select visible="{/Visible_banco}" items="{/Bancos}" selectedKey="{
                                                path:'/i_Banco',
                                                type : 'sap.ui.model.type.String',
                                                constraints:{minLength:1}
                                            }" width="30rem" change="handleBancoChange" forceSelection="false" app:identificador="banco">
                                                <core:Item key="{CODIGO}" text="{DESCRIPCION}"/>
                                            </Select>

                                            <Label visible="{/Visible_cuenta}" text="Cuenta" required="true"/>
                                            <Select visible="{/Visible_cuenta}" items="{/Cuentas}" selectedKey="{
                                                path:'/i_Cuenta',
                                                type : 'sap.ui.model.type.String',
                                                constraints:{minLength:1}
                                            }" width="30rem" change="handleSubFormChange" forceSelection="false" app:identificador="cuenta">
                                                <core:Item key="{CODIGO}" text="{CODIGO} - {DESCRIPCION}"/>
                                            </Select>

                                            <Label visible="{/Visible_institucion}" text="Institución" required="true"/>
                                            <Select visible="{/Visible_institucion}" items="{/Instituciones}" selectedKey="{
                                                path:'/i_Institucion',
                                                type : 'sap.ui.model.type.String',
                                                constraints:{minLength:1}
                                            }" width="30rem" change="handleSubFormChange" forceSelection="false" app:identificador="institucion">
                                                <core:Item key="{CODIGO}" text="{DESCRIPCION}"/>
                                            </Select>

                                            <Label visible="{/Visible_CUOTAS}" text="Cuotas" required="true"/>
                                            <Input type="Number" visible="{/Visible_CUOTAS}" width="5rem" value= "{path:'/CUOTAS',
	                                                type : 'sap.ui.model.type.Integer',
	                                                constraints:{minLength:1}}" change="handleSubFormChange" app:identificador="CUOTAS"/>

                                            <Label visible="{/Visible_observacion}" text="Observación" required="true"/>
                                            <Input visible="{/Visible_observacion}" value="{
                                                path:'/Observacion',
                                                type : 'sap.ui.model.type.String',
                                                constraints:{minLength:1}
                                            }" width="30rem" change="handleSubFormChange" app:identificador="observacion" />

                                            <Label visible="{/Visible_fecha_recaudacion}" text="Fecha Recaudacion" required="true"/>
                                            <DatePicker visible="{/Visible_fecha_recaudacion}" value="{
                                                    path:'/Fecha_Recaudacion',
                                                    type : 'sapui5agendar.sco00crearanticipo_html.customelements.ExtendedDate',
                                                    constraints:{required:'true'},
                                                    formatOptions: {source: {pattern: 'dd/MM/yyyy'}, pattern: 'dd/MM/yyyy'}
                                                }" width="30rem" change="handleSubFormChange" app:identificador="fecha_recaudacion"/>

                                        </f:content>
                                    </f:SimpleForm>
                                </f:content>
                            </f:SimpleForm>
                        </Panel>
                    </content>
                    <footer>
                        <Toolbar>

                            <Button id="errorPopover" icon="sap-icon://message-popup" visible="{= ${message>/}.length > 0}" text="{= ${message>/}.length}" type="Emphasized" press="handleMessagePopoverPress"/>
                            <ToolbarSpacer/>
                            <Button class="sapUiTinyMarginBegin" text="Generar Anticipos" icon="sap-icon://save" press="handleGenerarAnticipos"/>
                            <Button class="sapUiTinyMarginBegin" text="Limpiar" icon="sap-icon://delete" press="handleLimpiar"/>
                        </Toolbar>
                    </footer>
                </Page>
            </pages>
        </App>
    </Shell>
</mvc:View>
